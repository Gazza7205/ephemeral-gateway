# Copyright (c) 2018 CA. All rights reserved.
# This software may be modified and distributed under the terms
# of the MIT license.  See the LICENSE file for details.
version: '3.4'
services:
  gateway-dev:
    hostname: localhost
    image: caapim/gateway:9.4.00
    ports:
    - "8080:8080"
    - "8443:8443"
    - "8000:8000"
    volumes:
    
    - /opt/SecureSpan/Gateway/node/default/etc/bootstrap/services/restman
    - ./build/gateway/usergroup-1.0.0.gw7:/opt/docker/rc.d/deployment.gw7
    - ./lib/papim-1.0.0.bundle:/opt/SecureSpan/Gateway/node/default/etc/bootstrap/bundle/papim/papim-1.0.0.bundle
    # - ./lib/cluster-property.bundle:/opt/SecureSpan/Gateway/node/default/etc/bootstrap/bundle/papim/cluster-property.bundle
    secrets:
    - source: license
      target: /opt/SecureSpan/Gateway/node/default/etc/bootstrap/license/license.xml
    environment:
      ACCEPT_LICENSE: "true"
      SSG_ADMIN_USERNAME: "admin"
      SSG_ADMIN_PASSWORD: "password"
      ENV.CONTEXT_VARIABLE_PROPERTY.influxdb.influxdb: "influxdb.url"
      ENV.CONTEXT_VARIABLE_PROPERTY.influxdb.tags: "env=dev"
      #ENV.CONTEXT_VARIABLE_PROPERTY.#OTK Storage Configuration.dbsystem: "cassandra"
      ENV.PROPERTY.gateway.ENV.environment: "test"
      ENV.PROPERTY.gateway.ENV.buildnumber: 1
      ENV.PROPERTY.gateway.apm.epagent.tcpport: 9090
      ENV.PROPERTY.gateway.apm.epagent.httpport: 9080
      ENV.PROPERTY.gateway.apm.epagent.hostname: epagent.epagent.svc.cluster.local
      ENV.PROPERTY.gateway.apm.epagent.nodename: test-gateway
      ENV.PROPERTY.gateway.relayGatewayMetrics.enable: "true"
secrets:
  license:
    file: ./docker/license.xml